(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[964],{577:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin",function(){return l(7882)}])},7882:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return a}});var i=l(5893),n=l(7294),s=l(1163);function a(){let[e,t]=(0,n.useState)(""),[l,a]=(0,n.useState)(""),[d,r]=(0,n.useState)(""),[c,o]=(0,n.useState)(""),[u,h]=(0,n.useState)(""),[p,f]=(0,n.useState)(""),[x,m]=(0,n.useState)([]),[j,g]=(0,n.useState)(!0),[v,b]=(0,n.useState)(!1),y=(0,s.useRouter)();async function N(i){i.preventDefault();let n=localStorage.getItem("token"),s=new FormData;s.append("title",e),s.append("url",l),p&&s.append("folder",p),d&&s.append("thumbnail",d),c&&s.append("description",c);let o=document.getElementById("video-file"),u=document.getElementById("thumb-file");o&&o.files&&o.files[0]&&s.append("video",o.files[0]),u&&u.files&&u.files[0]&&s.append("thumbnail",u.files[0]);let x=await fetch("/api/upload",{method:"POST",headers:{"x-token":n||""},body:s}),m=await x.json();if(x.ok){h("Uploaded"),t(""),a(""),r(""),f("");let e=document.getElementById("video-file"),l=document.getElementById("thumb-file");e&&(e.value=""),l&&(l.value="")}else h(m.message||"Upload failed")}(0,n.useEffect)(()=>{let e=localStorage.getItem("token");if(!e){y.push("/login");return}fetch("/api/me",{headers:{"x-token":e}}).then(e=>e.json().then(t=>({ok:e.ok,d:t}))).then(e=>{let{ok:t,d:l}=e;if(!t){y.push("/login");return}b(!!l.isAdmin)}).catch(()=>y.push("/login")).finally(()=>g(!1))},[]),(0,n.useEffect)(()=>{fetch("/api/folders").then(e=>e.json()).then(e=>{m(Array.isArray(e)?e:[])}).catch(()=>m([]))},[]),(0,n.useEffect)(()=>{let e=localStorage.getItem("token");e&&fetch("/api/videos",{headers:{"x-token":e}}).then(e=>e.json()).then(e=>{S(e||[])}).catch(()=>{})},[]);let[k,S]=(0,n.useState)([]);async function E(e){let t=localStorage.getItem("token");if(!t||!confirm("Supprimer cette vid\xe9o ?"))return;let l=await fetch("/api/delete",{method:"POST",headers:{"Content-Type":"application/json","x-token":t},body:JSON.stringify({id:e})});if(l.ok)S(t=>t.filter(t=>t.id!==e)),h("Deleted");else{let e=await l.json().catch(()=>({}));h(e.message||"Delete failed")}}return j?(0,i.jsx)("div",{className:"container",children:(0,i.jsx)("h1",{children:"Chargement..."})}):v?(0,i.jsxs)("div",{className:"container",children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:16},children:[(0,i.jsx)("button",{onClick:()=>y.back(),className:"back-btn",children:"â†"}),(0,i.jsx)("h1",{style:{margin:0},children:"Admin - T\xe9l\xe9charger une vid\xe9o"})]}),(0,i.jsxs)("form",{onSubmit:N,children:[(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{children:"Titre"}),(0,i.jsx)("input",{value:e,onChange:e=>t(e.target.value)})]}),(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{children:"Dossier (optionnel)"}),(0,i.jsx)("input",{list:"folders",placeholder:"Enter folder name or choose...",value:p,onChange:e=>f(e.target.value)}),(0,i.jsx)("datalist",{id:"folders",children:x.map(e=>(0,i.jsx)("option",{value:e,children:e},e))})]}),(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{children:"URL de la vid\xe9o (YouTube ou lien de fichier)"}),(0,i.jsx)("input",{value:l,onChange:e=>a(e.target.value)})]}),(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{children:"Ou t\xe9l\xe9verser un fichier MP4"}),(0,i.jsx)("input",{id:"video-file",type:"file",accept:"video/mp4"})]}),(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{children:"URL de la miniature (facultatif)"}),(0,i.jsx)("input",{placeholder:"https://.../thumb.jpg",value:d,onChange:e=>r(e.target.value)})]}),(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{children:"Description"}),(0,i.jsx)("textarea",{value:c,onChange:e=>o(e.target.value)})]}),(0,i.jsxs)("div",{className:"field",children:[(0,i.jsx)("label",{children:"Ou t\xe9l\xe9verser une miniature PNG"}),(0,i.jsx)("input",{id:"thumb-file",type:"file",accept:"image/png,image/*"})]}),(0,i.jsx)("button",{type:"submit",children:"T\xe9l\xe9verser"})]}),u&&(0,i.jsx)("div",{style:{marginTop:12},children:u}),(0,i.jsxs)("section",{style:{marginTop:28},children:[(0,i.jsx)("h2",{children:"G\xe9rer les vid\xe9os"}),0===k.length&&(0,i.jsx)("p",{className:"small",children:"Pas de vid\xe9os"}),k.map(e=>(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"8px 0",borderBottom:"1px solid #f0f2f6"},children:[(0,i.jsxs)("div",{style:{flex:1},children:[(0,i.jsx)("strong",{children:e.title}),(0,i.jsxs)("div",{className:"small",children:["Vues : ",e.views||0," \xb7 Publi\xe9 par : ",e.uploadedBy]})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,i.jsx)("a",{href:e.url,target:"_blank",rel:"noreferrer",children:"Ouvrir"}),(0,i.jsx)("button",{onClick:()=>E(e.id),className:"btn-ghost",children:"Supprimer"})]})]},e.id))]})]}):(0,i.jsxs)("div",{className:"container",children:[(0,i.jsx)("h1",{children:"Page introuvable"}),(0,i.jsx)("p",{className:"small",children:"La page demand\xe9e est introuvable."})]})}},1163:function(e,t,l){e.exports=l(6885)}},function(e){e.O(0,[774,888,179],function(){return e(e.s=577)}),_N_E=e.O()}]);