(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(6626)}])},6626:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return o}});var s=n(5893),l=n(7294);function i(e){let{src:t,poster:n,onPlay:i}=e,a=(0,l.useRef)(null),[r,o]=(0,l.useState)(!1),[c,d]=(0,l.useState)(!1),[u,m]=(0,l.useState)(0);return(0,l.useEffect)(()=>{let e=a.current;if(!e)return;let t=()=>m(e.currentTime/(e.duration||1)*100);return e.addEventListener("timeupdate",t),()=>e.removeEventListener("timeupdate",t)},[]),(0,l.useEffect)(()=>{let e=e=>{if("Space"===e.code||" "===e.key){let t=document.fullscreenElement;if(!t)return;let n=a.current;n&&(t===n||t===n.parentElement||n.parentElement&&n.parentElement.contains(t))&&(e.preventDefault(),n.paused?(n.play(),o(!0),i&&i()):(n.pause(),o(!1)))}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[]),(0,s.jsxs)("div",{className:"player",children:[(0,s.jsx)("video",{ref:a,src:t,poster:n,className:"player-video",preload:"metadata"}),(0,s.jsxs)("div",{className:"player-controls",children:[(0,s.jsx)("button",{className:"player-btn",onClick:function(){let e=a.current;e&&(e.paused?(e.play(),o(!0),i&&i()):(e.pause(),o(!1)))},children:r?"❚❚":"▶"}),(0,s.jsx)("div",{className:"player-progress",onClick:function(e){let t=a.current;if(!t)return;let n=e.target.getBoundingClientRect(),s=(e.clientX-n.left)/n.width;t.currentTime=(t.duration||0)*s},role:"progressbar",children:(0,s.jsx)("div",{className:"player-progress-bar",style:{width:"".concat(u,"%")}})}),(0,s.jsx)("button",{className:"player-btn",onClick:function(){let e=a.current;e&&(e.loop=!e.loop,d(e.loop))},children:c?"\uD83D\uDD01":"↻"}),(0,s.jsx)("button",{className:"player-btn",onClick:function(){let e=a.current;if(!e)return;let t=e.parentElement||e;t.requestFullscreen&&t.requestFullscreen()},children:"⤢"})]})]})}function a(e){let{videoId:t,currentUser:n}=e,[i,a]=(0,l.useState)([]),[r,o]=(0,l.useState)(""),[c,d]=(0,l.useState)(!0);async function u(){let e=localStorage.getItem("token");if(!e)return alert("Connectez-vous");if(!r.trim())return;let n=await fetch("/api/comments",{method:"POST",headers:{"Content-Type":"application/json","x-token":e},body:JSON.stringify({videoId:t,text:r})});if(n.ok){let e=await n.json();a(t=>[...t,e]),o("")}}async function m(e){let n=localStorage.getItem("token");if(!n||!confirm("Supprimer ce commentaire ?"))return;let s=await fetch("/api/comments",{method:"DELETE",headers:{"Content-Type":"application/json","x-token":n},body:JSON.stringify({videoId:t,commentId:e})});s.ok&&a(t=>t.filter(t=>t.id!==e))}if((0,l.useEffect)(()=>{fetch("/api/comments?videoId=".concat(encodeURIComponent(t))).then(e=>e.json()).then(a).catch(()=>a([])).finally(()=>d(!1))},[t]),c)return null;let h=localStorage.getItem("username");return h?(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{style:{marginBottom:8},children:[(0,s.jsx)("textarea",{value:r,onChange:e=>o(e.target.value),placeholder:"\xc9crire un commentaire...",style:{width:"100%",minHeight:60,padding:8,borderRadius:8}}),(0,s.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:8},children:(0,s.jsx)("button",{onClick:u,className:"btn-ghost",children:"Publier"})})]}),(0,s.jsxs)("div",{children:[0===i.length&&(0,s.jsx)("div",{className:"small",children:"Aucun commentaire"}),i.map(e=>(0,s.jsxs)("div",{style:{padding:"8px 0",borderBottom:"1px solid var(--muted-bg)"},children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,s.jsx)("strong",{children:e.author}),(0,s.jsx)("div",{className:"small",children:new Date(e.createdAt).toLocaleString()})]}),(0,s.jsx)("div",{style:{marginTop:6},children:e.text}),e.author===h&&(0,s.jsx)("div",{style:{marginTop:6},children:(0,s.jsx)("button",{onClick:()=>m(e.id),className:"btn-ghost",children:"Supprimer"})})]},e.id))]})]}):(0,s.jsx)("div",{className:"small",children:"Connectez-vous pour voir et poster des commentaires."})}var r=n(1163);function o(){let[e,t]=(0,l.useState)([]),[n,o]=(0,l.useState)(!0),[c,d]=(0,l.useState)(!1),[u,m]=(0,l.useState)({}),[h,p]=(0,l.useState)({}),[g,f]=(0,l.useState)(""),[y,x]=(0,l.useState)([]),[j,v]=(0,l.useState)(""),b=(0,r.useRouter)(),[k,S]=(0,l.useState)(localStorage.getItem("theme")||"light"),[N,C]=(0,l.useState)(localStorage.getItem("lang")||"fr");async function w(e){try{let n=await fetch("/api/view",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})});if(n.ok){let s=await n.json();t(t=>t.map(t=>t.id===e?{...t,views:s.views}:t))}}catch(e){}}async function E(e){try{let n=!!localStorage.getItem("liked_"+e);if(n){let n=await fetch("/api/unlike",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})});if(n.ok){let s=await n.json();t(t=>t.map(t=>t.id===e?{...t,likes:s.likes}:t)),localStorage.removeItem("liked_"+e)}}else{let n=await fetch("/api/like",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})});if(n.ok){let s=await n.json();t(t=>t.map(t=>t.id===e?{...t,likes:s.likes}:t)),localStorage.setItem("liked_"+e,"1")}}}catch(e){}}(0,l.useEffect)(()=>{document.documentElement.classList.remove("light","dark"),document.documentElement.classList.add("dark"===k?"dark":"light"),localStorage.setItem("theme",k),localStorage.setItem("lang",N),document.documentElement.dir="ar"===N?"rtl":"ltr"},[k,N]),(0,l.useEffect)(()=>{let e=localStorage.getItem("token");if(!e){b.push("/login");return}fetch("/api/me",{headers:{"x-token":e}}).then(async e=>{if(!e.ok){b.push("/login");return}let n=await e.json();d(!!n.isAdmin);try{let e=await fetch("/api/videos").then(e=>e.json());t(Array.isArray(e)?e:[])}catch(e){t([])}try{let e=await fetch("/api/folders").then(e=>e.json());x(Array.isArray(e)?e:[])}catch(e){}o(!1)}).catch(()=>b.push("/login"))},[]);let I=(g||"").trim().toLowerCase(),T=e.filter(e=>{if(j&&(!e.url||!(e.url.includes("/uploads/")&&e.url.includes(j))))return!1;if(!I)return!0;let t=String(e.title||""),n=String(e.description||"");return t.toLowerCase().includes(I)||n.toLowerCase().includes(I)});return n?(0,s.jsx)("div",{className:"container",children:(0,s.jsx)("h1",{children:"Loading..."})}):(0,s.jsxs)("div",{className:"container",children:[(0,s.jsxs)("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,s.jsx)("img",{src:"/Untitled-1.svg",alt:"logo",style:{width:40,height:40}}),(0,s.jsx)("h1",{style:{margin:0},children:"lissafa top"})]}),(0,s.jsxs)("div",{className:"nav",children:[(0,s.jsxs)("select",{value:N,onChange:e=>C(e.target.value),style:{padding:8,borderRadius:8},children:[(0,s.jsx)("option",{value:"fr",children:"FR"}),(0,s.jsx)("option",{value:"ar",children:"AR"})]}),(0,s.jsx)("button",{onClick:()=>S(e=>"dark"===e?"light":"dark"),className:"btn-ghost",style:{marginLeft:8},children:"dark"===k?"☀️":"\uD83C\uDF19"}),c&&(0,s.jsx)("a",{href:"/admin",style:{marginRight:12,marginLeft:12},children:"Admin"}),(0,s.jsx)("button",{onClick:function(){localStorage.removeItem("token"),localStorage.removeItem("username"),b.push("/login")},className:"btn-ghost",children:"D\xe9connexion"})]})]}),(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12,marginTop:12},children:[(0,s.jsx)("h2",{style:{margin:0},children:"Vid\xe9os"}),(0,s.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,s.jsx)("input",{placeholder:"Search videos...",value:g,onChange:e=>f(e.target.value),style:{padding:8,borderRadius:8,border:"1px solid var(--muted-bg)"}}),(0,s.jsxs)("select",{value:j,onChange:e=>v(e.target.value),style:{padding:8,borderRadius:8},children:[(0,s.jsx)("option",{value:"",children:"All folders"}),y.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]})]}),y.length>0&&(0,s.jsxs)("div",{style:{marginTop:12,display:"flex",gap:8,flexWrap:"wrap"},children:[y.map(e=>(0,s.jsx)("button",{className:e===j?"btn-primary":"btn-outline",onClick:()=>v(e),style:{padding:"6px 10px"},children:e},e)),j&&(0,s.jsx)("button",{className:"btn-ghost",onClick:()=>v(""),children:"Clear"})]}),0===T.length&&(0,s.jsx)("p",{className:"small",children:"No videos found."}),T.map(e=>{let t=Array.isArray(e.title)?e.title[0]:e.title||"";return(0,s.jsx)("div",{className:"video-item",children:(0,s.jsxs)("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[(0,s.jsxs)("div",{style:{position:"relative"},children:[e.thumbnail?(0,s.jsx)("img",{src:e.thumbnail,className:"thumb",alt:t,loading:"lazy"}):(0,s.jsx)("div",{className:"thumb",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:t}),!h[e.id]&&e.url&&e.url.endsWith(".mp4")&&(0,s.jsx)("button",{onClick:()=>p(t=>({...t,[e.id]:!0})),className:"player-btn",style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)"},children:"Play"})]}),(0,s.jsxs)("div",{style:{flex:1},children:[h[e.id]&&e.url&&e.url.endsWith(".mp4")&&(0,s.jsx)(i,{src:e.url,poster:e.thumbnail||void 0,onPlay:()=>w(e.id)}),(0,s.jsx)("div",{style:{marginTop:8},children:(0,s.jsx)("strong",{children:t})}),e.description&&(0,s.jsx)("div",{className:"small",style:{marginTop:6},children:e.description}),(0,s.jsxs)("div",{style:{display:"flex",gap:12,alignItems:"center",marginTop:8},children:[(0,s.jsxs)("div",{className:"small",children:["Vues : ",e.views||0]}),(0,s.jsxs)("div",{className:"small",children:["Likes : ",e.likes||0]}),(0,s.jsx)("button",{onClick:()=>E(e.id),className:"player-btn",children:"❤"})]}),e.uploadedBy&&(0,s.jsxs)("div",{className:"small",children:["Publi\xe9 par : ",e.uploadedBy]}),(0,s.jsxs)("div",{style:{marginTop:10},children:[(0,s.jsx)("button",{className:"btn-ghost",onClick:()=>m(t=>({...t,[e.id]:!t[e.id]})),children:u[e.id]?"Hide comments":"Show comments"}),u[e.id]&&(0,s.jsx)("div",{style:{marginTop:8},children:(0,s.jsx)(a,{videoId:e.id,currentUser:localStorage.getItem("username")})})]})]})]})},e.id)})]})}},1163:function(e,t,n){e.exports=n(6885)}},function(e){e.O(0,[774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);